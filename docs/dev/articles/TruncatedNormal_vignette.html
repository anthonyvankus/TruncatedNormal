<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TruncatedNormal package â€¢ TruncatedNormal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="TruncatedNormal package">
<meta property="og:description" content="TruncatedNormal">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TruncatedNormal</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">2.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TruncatedNormal_vignette.html">TruncatedNormal package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lbelzile/TruncatedNormal/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>TruncatedNormal package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/TruncatedNormal/blob/master/vignettes/TruncatedNormal_vignette.Rmd"><code>vignettes/TruncatedNormal_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>TruncatedNormal_vignette.Rmd</code></div>

    </div>

    
    
<p>The <code>TruncatedNormal</code> package provides numerical routines to estimate the probability that Gaussian and Student random vectors fall in a hyperrectangle of the form <span class="math inline">\([\boldsymbol{l}, \boldsymbol{u}]\)</span>, namely <span class="math inline">\(\Pr(\boldsymbol{l} \leq \boldsymbol{X} \leq \boldsymbol{u})\)</span> for <span class="math inline">\(\boldsymbol{X} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})\)</span> or<span class="math inline">\(\boldsymbol{X} \sim \mathcal{T}_{\nu}(\boldsymbol{\mu}, \boldsymbol{\Sigma})\)</span>, where <span class="math inline">\(\boldsymbol{\mu}\)</span> is a location vector, <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is a scale matrix and <span class="math inline">\(\nu\)</span> is the degree of freedom of the Student vector.</p>
<p>The minimax exponential tilting method is an alternative to the separation of variables estimator implemented in the package <code>mvtnorm</code>; the package <code>mvPot</code> also implements the separation of variables method and uses quasi Monte Carlo, but is restricted to integrals of the form <span class="math inline">\([-\boldsymbol{\infty}_D, \boldsymbol{u}]\)</span>.</p>
<div id="example-1-simulation-of-gaussian-variables-subject-to-linear-restrictions" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-simulation-of-gaussian-variables-subject-to-linear-restrictions" class="anchor"></a>Example 1: Simulation of Gaussian variables subject to linear restrictions</h3>
<p>Suppose we wish to simulate a bivariate vector <span class="math inline">\(\boldsymbol{X} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})\)</span> conditional on <span class="math inline">\(X_1-X_2 &lt; -6\)</span>. Setting <span class="math inline">\(\mathbf{A} = \left( \begin{smallmatrix} 1 &amp; -1 \\ 0 &amp; 1\end{smallmatrix}\right)\)</span>. We can simulate <span class="math inline">\(\boldsymbol{Y} \sim \mathcal{N}(\mathbf{A}\boldsymbol{\mu},\mathbf{A}\boldsymbol{\Sigma}\mathbf{A}^\top)\)</span> conditional on <span class="math inline">\(\boldsymbol{l} \leq \boldsymbol{Y} \leq \boldsymbol{u}\)</span> and then set <span class="math inline">\(\boldsymbol{X} = \mathbf{A}^{-1}\boldsymbol{Y}\)</span>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">TruncatedNormal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">1</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">mu</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>, <span class="fl">0</span>)
<span class="no">u</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">6</span>, <span class="fl">Inf</span>)
<span class="no">A</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,-<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co"># Sample truncated Gaussian variables and back-transforms</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rtmvnorm.html">rtmvnorm</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e2</span>, <span class="kw">mu</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">A</span> <span class="kw">%*%</span> <span class="no">mu</span>), <span class="kw">sigma</span> <span class="kw">=</span> <span class="no">A</span> <span class="kw">%*%</span> <span class="no">sigma</span> <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">A</span>), <span class="kw">ub</span> <span class="kw">=</span> <span class="no">u</span>)
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="no">A</span>) <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">Y</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">X</span>, <span class="kw">panel.first</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">a</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">b</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">2</span>),
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">x</span>[<span class="fl">1</span>]), <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">x</span>[<span class="fl">2</span>]),
     <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">8</span>,<span class="fl">0</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>,<span class="fl">5</span>))
<span class="co"># Compare with unconstrained samples</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="fu"><a href="../reference/rtmvnorm.html">rtmvnorm</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="fl">1e2</span>, <span class="kw">mu</span> <span class="kw">=</span> <span class="no">mu</span>, <span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fl">4</span>)</pre></body></html></div>
<p><img src="TruncatedNormal_vignette_files/figure-html/simutrunc-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="example-2-estimating-the-probability-of-rare-events" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-estimating-the-probability-of-rare-events" class="anchor"></a>Example 2: Estimating the probability of rare events</h3>
<p>We can estimate numerically the probability that <span class="math inline">\(\boldsymbol{X} \geq \boldsymbol{0}_d\)</span> for <span class="math inline">\(\boldsymbol{X} \sim \mathcal{N}(\boldsymbol{0}_d, 0.5\mathbf{I}_d + 0.5\mathbf{1}_d\mathbf{1}_d^\top)\)</span>, which is known and equal <span class="math inline">\((d+1)^{-1}\)</span>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">d</span> <span class="kw">&lt;-</span> <span class="fl">1000</span>
<span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span> * (<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">d</span>) + <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>, <span class="no">d</span>, <span class="no">d</span>))
<span class="no">est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pmvnorm.html">pmvnorm</a></span>(<span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="no">d</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"qmc"</span>, <span class="kw">B</span> <span class="kw">=</span> <span class="fl">1e4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">est</span>)
<span class="co">#&gt; [1] 0.0009987621</span>
<span class="co">#&gt; attr(,"relerr")</span>
<span class="co">#&gt; [1] 0.007122615</span>
<span class="co">#&gt; attr(,"upbnd")</span>
<span class="co">#&gt; [1] 0.002963262</span>
<span class="co">#Compare est with exact value by computing relative error</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">est</span> - <span class="fl">1</span>/(<span class="no">d</span>+<span class="fl">1</span>))*(<span class="no">d</span>+<span class="fl">1</span>)
<span class="co">#&gt; [1] 0.0002391284</span>
<span class="co">#&gt; attr(,"relerr")</span>
<span class="co">#&gt; [1] 0.007122615</span>
<span class="co">#&gt; attr(,"upbnd")</span>
<span class="co">#&gt; [1] 0.002963262</span></pre></body></html></div>
</div>
<div id="example-3-high-dimensional-truncated-student-with-positive-correlation" class="section level3">
<h3 class="hasAnchor">
<a href="#example-3-high-dimensional-truncated-student-with-positive-correlation" class="anchor"></a>Example 3: High-dimensional truncated Student with positive correlation</h3>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">d</span> <span class="kw">&lt;-</span> <span class="fl">60</span>
<span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fl">0.1</span> * <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">d</span>) + <span class="fl">0.9</span> * <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>, <span class="no">d</span>, <span class="no">d</span>)
<span class="no">l</span> <span class="kw">&lt;-</span> (<span class="fl">1</span>:<span class="no">d</span>)/(<span class="fl">4</span>*<span class="no">d</span>); <span class="no">u</span> <span class="kw">&lt;-</span> <span class="no">l</span> + <span class="fl">2</span>
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rtmvt.html">rtmvt</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e4</span>, <span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="no">l</span>, <span class="kw">ub</span> <span class="kw">=</span> <span class="no">u</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">X</span>) ~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fl">1</span>:<span class="no">d</span>), <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"dimension index"</span>,
        <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">X</span>[<span class="st">"i"</span>]))</pre></body></html></div>
<p><img src="TruncatedNormal_vignette_files/figure-html/highdim-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="example-4-normal-quantile-function-with-tail-precision" class="section level3">
<h3 class="hasAnchor">
<a href="#example-4-normal-quantile-function-with-tail-precision" class="anchor"></a>Example 4: Normal quantile function with tail-precision</h3>
<p>The package includes two normal quantile functions that can be used to simulate truncated Gaussian variables with high precision using the inverse transform method (which is useful for quasi Monte Carlo integration) or a fast alternative.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">l</span> <span class="kw">&lt;-</span> <span class="fl">9</span>; <span class="no">u</span> <span class="kw">&lt;-</span> <span class="fl">9.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="fu"><a href="../reference/rtnorm.html">rtnorm</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e4</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="no">l</span>, <span class="kw">ub</span> <span class="kw">=</span> <span class="no">u</span>),
     <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">9</span>,<span class="fl">9.5</span>), <span class="kw">xaxs</span> <span class="kw">=</span> <span class="st">"i"</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"x"</span>)</pre></body></html></div>
<p><img src="TruncatedNormal_vignette_files/figure-html/normqprec-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Now compare speed of the two methods</span>
<span class="no">timing</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">20</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">20</span>){
  <span class="no">timing</span>[<span class="no">i</span>,] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/rtnorm.html">rtnorm</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e5</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="no">l</span>, <span class="kw">ub</span> <span class="kw">=</span> <span class="no">u</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"fast"</span>))[<span class="fl">3</span>],
    <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/rtnorm.html">rtnorm</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e5</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="no">l</span>, <span class="kw">ub</span> <span class="kw">=</span> <span class="no">u</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"invtransfo"</span>))[<span class="fl">3</span>]
  )
}
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">timing</span>)
<span class="co">#&gt; [1] 0.01925 0.02980</span></pre></body></html></div>
</div>
<div id="example-5-probit-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#example-5-probit-regression" class="anchor"></a>Example 5: Probit regression</h3>
<p>The example uses the <em>Lupus nephritis</em> dataset from</p>
<blockquote>
<p>D. A. van Dyk and X.-L. Meng (2001). <em>The art of data augmentation (with discussion)</em>. Journal of Computational and Graphical Statistics, <strong>10</strong>(1), pp.Â 1-50.</p>
</blockquote>
<p>If <span class="math inline">\(\boldsymbol{\beta}\sim \mathcal{N}(\mathbf{0},\sigma^2 \mathbf{I}_d)\)</span> for known <span class="math inline">\(\sigma^2\)</span>, we first simulate <span class="math display">\[\mathbf{Z}\sim N(\mathbf{0},\boldsymbol{\Sigma}),\qquad \boldsymbol{\Sigma}=\mathbf{I}_d+\sigma^2 \mathbf{X X}^\top,\]</span> conditional on <span class="math inline">\(\mathbf{Z}\geq \mathbf{0}\)</span> and next simulate the posterior regression coefficients of the probit regression, <span class="math inline">\(\boldsymbol{\beta}\)</span>, viz. <span class="math display">\[\boldsymbol{\beta}|\mathbf{Z}\sim \mathcal{N}(\mathbf{C X}^\top \mathbf{Z},\mathbf{C}),\qquad  \mathbf{C}^{-1}=\mathbf{I}_d/\sigma^2+ \mathbf{X}^\top\mathbf{X}.\]</span></p>
<p>We can perform similar inference with the <em>Lupus nephritis</em> dataset</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Exact Bayesian Posterior Simulation Example.</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"lupus"</span>); <span class="co"># load lupus data</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">lupus</span>[,<span class="fl">1</span>]; <span class="co"># response data</span>
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">lupus</span>[,-<span class="fl">1</span>])  <span class="co"># construct design matrix</span>
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">X</span>)
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">X</span>)
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">2</span>*<span class="no">Y</span>-<span class="fl">1</span>) <span class="kw">%*%</span> <span class="no">X</span>; <span class="co"># incorporate response into design matrix</span>
<span class="no">nusq</span> <span class="kw">&lt;-</span> <span class="fl">10000</span>; <span class="co"># prior scale parameter</span>
<span class="no">C</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">d</span>)/<span class="no">nusq</span> + <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">X</span>))
<span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">n</span>) + <span class="no">nusq</span>*<span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">tcrossprod</a></span>(<span class="no">X</span>) <span class="co"># this is covariance of Z given beta</span>
<span class="no">est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pmvnorm.html">pmvnorm</a></span>(<span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="co"># estimate acceptance probability of crude Monte Carlo</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">est</span>)$<span class="no">upbnd</span>/<span class="no">est</span>[<span class="fl">1</span>])
<span class="co">#&gt; [1] 5.483607</span>
<span class="co"># reciprocal of acceptance probability</span>
<span class="no">Z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rtmvnorm.html">rtmvnorm</a></span>(<span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1e3</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="no">n</span>))
 <span class="co"># sample exactly from auxiliary distribution</span>
<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rtmvnorm.html">rtmvnorm</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Z</span>), <span class="kw">sigma</span> <span class="kw">=</span> <span class="no">C</span>) + <span class="no">Z</span> <span class="kw">%*%</span> <span class="no">X</span> <span class="kw">%*%</span> <span class="no">C</span>
 <span class="co"># simulate beta given Z and plot boxplots of marginals</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="no">beta</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">beta</span>))</pre></body></html></div>
<p><img src="TruncatedNormal_vignette_files/figure-html/probitneph-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># plot the boxplots of the marginal distribution of the betas</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">beta</span>)) <span class="co"># output the posterior means</span>
<span class="co">#&gt;     const        x1        x2 </span>
<span class="co">#&gt; -2.863832  6.695612  3.800347</span></pre></body></html></div>
</div>
<div id="example-6-tobit-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#example-6-tobit-regression" class="anchor"></a>Example 6: Tobit regression</h3>
<p>We use the women wage dataset from</p>
<blockquote>
<p>T. A. Mroz, 1987. <em>The Sensitivity of an Empirical Model of Married Womenâ€™s Hours of Work to Economic and Statistical Assumptions</em>, Econometrica, <strong>55</strong>(4), pp.Â 765-799</p>
</blockquote>
<p>The response variables <span class="math inline">\(\boldsymbol{y} \in \{0,1\}^n\)</span> in the Tobit model is modelled as <span class="math display">\[Y_i = W_i \mathrm{I}\{u_i &lt; W_i\} + u_i \mathrm{I}\{W_i \leq u_i\}, \qquad \boldsymbol{W} \sim \mathcal{N}(\mathbf{X}\boldsymbol{\beta}, \sigma^2\mathbf{I}_n),
\]</span> where <span class="math inline">\(\boldsymbol{W}\)</span> are latent variables, <span class="math inline">\((\boldsymbol{\beta}, \sigma)\)</span> are the model parameters, and <span class="math inline">\(\mathbf{X}\)</span> is an <span class="math inline">\((n \times p)\)</span> matrix of predictors.</p>
<p>If we wish to sample from the Bayesian posterior with improper prior <span class="math inline">\(p(\boldsymbol{\beta}) \propto 1\)</span> and <span class="math inline">\(p(\sigma) \propto \sigma^{-2}\)</span>, the posterior is</p>
<p><span class="math display">\[p(\boldsymbol{\beta},\sigma \mid \boldsymbol{y}, \mathbf{X})\propto \sigma^{-2}\exp\left[-\sum_{i:y_i&gt;u_i}\left\{\frac{(y_i-\mathbf{x}_i^\top\beta)^2}{2\sigma^2}+\log(\sigma)\right\}+\sum_{i: y_i=u_i}\log\left\{\Phi\left( \frac{u_i-\mathbf{x}_i^\top\beta}{\sigma}\right)\right\}\right]. \]</span> A change of variable <span class="math inline">\((\boldsymbol{\beta}, \sigma) \mapsto (\boldsymbol{z}, r)\)</span> shows that simulating from the above posterior is equivalent to simulating from the truncated posterior distribution function <span class="math display">\[ p(\mathbf{z}, r\mid \boldsymbol{y}, \mathbf{X})\propto
 \exp\left\{-\frac{\mathbf{z}^\top\mathbf{z}}{2}-\frac{r^2}{2}+(\nu-1)\ln
 r\right\}\mathrm{I}\{\sqrt{\nu}\, \mathbf{L}\mathbf{z}\geq r \mathbf{ l}\}, \]</span> where <span class="math inline">\(\mathbf{L}\)</span> is a lower triangular matrix and <span class="math inline">\(\mathbf{l}\)</span> is a vector of lower truncation limits. The distribution of <span class="math inline">\(\nu^{1/2} \mathbf{LZ}/R\)</span> is truncated multivariate Student <span class="math inline">\(\mathcal{T}_{\nu}(\mathbf{LL}^\top)\)</span> with lower limit <span class="math inline">\(\mathbf{l}\)</span>.</p>
<p>Partition the response vector and the design matrix into <span class="math inline">\(\boldsymbol{y} = [\boldsymbol{y}_u, \boldsymbol{y}_c]\)</span> for the <span class="math inline">\(n_u\)</span> uncensored and <span class="math inline">\(n-n_u\)</span> uncensored observations, with <span class="math inline">\(\mathbf{X}_u\)</span>, <span class="math inline">\(\mathbf{X}_c\)</span> the corresponding design matrix and <span class="math inline">\(\mathbf{H}_{\mathbf{X}}\)</span> the projection matrix onto the span of <span class="math inline">\(\mathbf{X}\)</span>. Then <span class="math inline">\(s_u = \{\boldsymbol{y}_u^\top(\mathbf{I}_d -\mathrm{H}_{\mathbf{X}_u})\boldsymbol{y}_u\}^{1/2}\)</span> is the estimated standard error of the linear regression with the complete cases, <span class="math inline">\(\nu = n_u-d+1\)</span> are the degrees of freedom, <span class="math inline">\(\widehat{\boldsymbol{\beta}}_u = (\mathbf{X}_u^\top\mathbf{X}_u)^{-1}\mathbf{X}_u^\top\boldsymbol{y}_u\)</span> are the least square coefficients for the uncensored observations and <span class="math inline">\(\widehat{\boldsymbol{y}}_c = \mathbf{X}_c \widehat{\boldsymbol{\beta}}_u\)</span> the fitted values for the remaining observations.</p>
<p>The change of variable gives <span class="math inline">\(\sigma =s_u/R\)</span> and <span class="math display">\[\boldsymbol{\beta} = (\mathbf{X}_u^\top\mathbf{X}_u + \mathbf{X}_c^\top\mathbf{X}_c)^{-1}\left\{\mathbf{X}_u^\top\boldsymbol{y}_u + \mathbf{X}_c^\top(\widehat{\boldsymbol{y}}_c-\sigma\boldsymbol{Z})\right\}, \qquad \boldsymbol{W} = \widehat{\boldsymbol{y}}_c - \sigma\boldsymbol{Z}.\]</span> The lower truncation is then <span class="math inline">\(\nu^{1/2}\widehat{\boldsymbol{y}}_c/s_u\)</span>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">mroz</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"TruncatedNormal"</span>)
<span class="co">#Censored observations denote Yc, Yu for uncensored</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">mroz</span>[,<span class="st">"whrs"</span>]
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">mroz</span>[,-<span class="fl">1</span>]), <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">mroz</span>[,<span class="st">"exp"</span>]^<span class="fl">2</span>))
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">X</span>); <span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">X</span>)
<span class="no">uncens</span> <span class="kw">&lt;-</span> <span class="no">Y</span> <span class="kw">&gt;</span> <span class="fl">0</span>
<span class="no">Yu</span> <span class="kw">&lt;-</span> <span class="no">Y</span>[<span class="no">uncens</span>]; <span class="no">Yc</span> <span class="kw">&lt;-</span> <span class="no">Y</span>[!<span class="no">uncens</span>]
<span class="no">Xu</span> <span class="kw">&lt;-</span> <span class="no">X</span>[<span class="no">uncens</span>,]; <span class="no">Xc</span> <span class="kw">&lt;-</span> <span class="no">X</span>[!<span class="no">uncens</span>,]
<span class="no">invXtXu</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xu</span>))
<span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Xc</span>)) + <span class="no">Xc</span> <span class="kw">%*%</span> <span class="no">invXtXu</span> <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">Xc</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">Yu</span>) <span class="kw">%*%</span> (<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Xu</span>))- <span class="no">Xu</span> <span class="kw">%*%</span> <span class="no">invXtXu</span> <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">Xu</span>)) <span class="kw">%*%</span> <span class="no">Yu</span>))
<span class="co"># least squares residual variance estimate</span>
<span class="no">nu</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Xu</span>) - (<span class="no">d</span> - <span class="fl">1</span>) <span class="co"># degrees of freedom</span>
<span class="no">beta_hat</span> <span class="kw">&lt;-</span> <span class="no">invXtXu</span> <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xu</span>, <span class="no">Yu</span>)
<span class="no">Yc_hat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Xc</span> <span class="kw">%*%</span> <span class="no">beta_hat</span>) <span class="co"># fitted values</span>
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">nu</span>) * <span class="no">Yc_hat</span>/<span class="no">s</span> <span class="co"># upper threshold for censoring is zero</span>
<span class="co"># simulate (Z,R) from a truncated Student</span>
<span class="no">B</span> <span class="kw">&lt;-</span> <span class="fl">1e3</span>
<span class="no">TR</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tregress.html">tregress</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="no">B</span>, <span class="kw">lb</span> <span class="kw">=</span> <span class="no">l</span>, <span class="kw">ub</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">l</span>)), <span class="kw">sigma</span> <span class="kw">=</span> <span class="no">sigma</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="no">nu</span>)
<span class="no">R</span> <span class="kw">&lt;-</span> <span class="no">TR</span>$<span class="no">R</span>
<span class="no">Z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">TR</span>$<span class="no">Z</span>)
<span class="co"># Reverse the mapping (beta,sigma) -&gt; (Z,R) </span>
<span class="no">sig</span> <span class="kw">&lt;-</span> <span class="no">s</span>/<span class="no">R</span> <span class="co"># posterior of sigma</span>
<span class="no">C</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xu</span>) + <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xc</span>))
<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">B</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="no">d</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">B</span>){
    <span class="no">W</span> <span class="kw">&lt;-</span> <span class="no">Yc_hat</span> - <span class="no">sig</span>[<span class="no">i</span>]*<span class="no">Z</span>[,<span class="no">i</span>] <span class="co"># auxiliary variables</span>
    <span class="no">beta</span>[<span class="no">i</span>,] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">C</span> <span class="kw">%*%</span> (<span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xu</span>, <span class="no">Yu</span>) + <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(<span class="no">Xc</span>, <span class="no">W</span>))) +
                    <span class="no">sig</span>[<span class="no">i</span>]*<span class="fu"><a href="../reference/rtmvnorm.html">rtmvnorm</a></span>(<span class="kw">sigma</span> <span class="kw">=</span> <span class="no">C</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>)
}
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">beta</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">X</span>)
<span class="co"># Boxplots of the marginal posterior distribution</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="no">beta</span>[,-<span class="fl">1</span>], <span class="kw">las</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">beta</span>))</pre></body></html></div>
<p><img src="TruncatedNormal_vignette_files/figure-html/tobit-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Plot marginal means and standard deviations</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">beta</span>)
<span class="co">#&gt;        V1            kidslt6           kidsge6              age        </span>
<span class="co">#&gt;  Min.   :-279.2   Min.   :-1096.0   Min.   :-152.744   Min.   :-71.56  </span>
<span class="co">#&gt;  1st Qu.:1118.1   1st Qu.: -806.8   1st Qu.: -42.839   1st Qu.:-53.31  </span>
<span class="co">#&gt;  Median :1412.4   Median : -738.6   Median : -19.387   Median :-48.77  </span>
<span class="co">#&gt;  Mean   :1414.2   Mean   : -738.6   Mean   : -19.553   Mean   :-48.83  </span>
<span class="co">#&gt;  3rd Qu.:1703.1   3rd Qu.: -670.3   3rd Qu.:   4.924   3rd Qu.:-43.95  </span>
<span class="co">#&gt;  Max.   :2923.8   Max.   : -387.5   Max.   : 122.872   Max.   :-28.55  </span>
<span class="co">#&gt;       educ             hearn            exp               V8          </span>
<span class="co">#&gt;  Min.   :-82.322   Min.   :108.8   Min.   : 57.03   Min.   :-4.36975  </span>
<span class="co">#&gt;  1st Qu.:-25.529   1st Qu.:148.3   1st Qu.: 98.09   1st Qu.:-1.80218  </span>
<span class="co">#&gt;  Median :-10.892   Median :158.2   Median :108.70   Median :-1.47622  </span>
<span class="co">#&gt;  Mean   :-10.922   Mean   :158.5   Mean   :109.01   Mean   :-1.48493  </span>
<span class="co">#&gt;  3rd Qu.:  4.059   3rd Qu.:168.1   3rd Qu.:119.91   3rd Qu.:-1.12933  </span>
<span class="co">#&gt;  Max.   : 49.804   Max.   :211.9   Max.   :201.00   Max.   : 0.06102</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zdravko Botev, Leo Belzile.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
